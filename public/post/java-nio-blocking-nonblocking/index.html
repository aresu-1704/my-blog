<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Phân tích sâu về sự chuyển đổi từ blocking I/O sang non-blocking I/O trong Java. Hiểu rõ Java NIO, Selector, Multiplexing và cách chúng thay đổi kiến trúc server hiện đại"
    />
    <title>
      Từ Blocking I/O đến Non-blocking I/O: Java NIO thay đổi cách Server xử lý mạng như thế nào? - THUẬN AN IT BLOG
    </title>

    
    
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />
    

    
    <script src="https://cdn.tailwindcss.com"></script>

    
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff",
                100: "#e0f2fe",
                200: "#bae6fd",
                300: "#7dd3fc",
                400: "#38bdf8",
                500: "#0ea5e9",
                600: "#0284c7",
                700: "#0369a1",
                800: "#075985",
                900: "#0c4a6e",
              },
            },
          },
        },
      };
    </script>

    
     
    <link rel="stylesheet" href="/css/main.min.96a535f2c9e6b011f54cdd8701868801ab256ec3404f1d1873675f82f8f961cb.css" />
    
  </head>
  <body class="bg-slate-900 text-gray-100">
    
    
<nav class="bg-slate-950 border-b border-slate-800 shadow-lg sticky top-0 z-50">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16">
      
      <div class="flex items-center gap-3">
        
        <img
          src="/icon/icon.png"
          alt="Blog Icon"
          class="w-10 h-10 rounded-lg"
        />

        
        <div>
          <a
            href="/"
            class="text-xl font-bold text-cyan-400 hover:text-cyan-300 transition-colors block"
          >
            THUẬN AN IT BLOG
          </a>
          <p class="text-xs text-gray-400">
            Blog chia sẻ kiến thức về lập trình & AI
          </p>
        </div>
      </div>

      
      <div class="hidden md:flex items-center space-x-6">
        
        <a
          href="/"
          class="text-gray-300 hover:text-cyan-400 transition-colors font-medium text-sm"
        >
          Home
        </a>

        
        
        <a
          href="/research/"
          class="text-gray-300 hover:text-cyan-400 transition-colors font-medium text-sm"
        >
          Nghiên cứu
        </a>
        
        <a
          href="/portfolio/"
          class="text-gray-300 hover:text-cyan-400 transition-colors font-medium text-sm"
        >
          Dự án
        </a>
        
        <a
          href="/about/"
          class="text-gray-300 hover:text-cyan-400 transition-colors font-medium text-sm"
        >
          Về bản thân
        </a>
        
        <a
          href="/contact/"
          class="text-gray-300 hover:text-cyan-400 transition-colors font-medium text-sm"
        >
          Liên hệ
        </a>
        

        
        <div class="relative group">
          <button
            class="text-gray-300 hover:text-cyan-400 transition-colors font-medium flex items-center text-sm"
          >
            Categories
            <svg
              class="w-4 h-4 ml-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              ></path>
            </svg>
          </button>

          
          <div
            class="absolute left-0 mt-2 w-48 bg-slate-800 border border-slate-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200"
          >
            <div class="py-2">
              
              <a
                href="//localhost:1313/categories/backend/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                Backend
                <span class="text-gray-500 text-xs">(1)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/java/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                Java
                <span class="text-gray-500 text-xs">(6)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/javascript/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                JavaScript
                <span class="text-gray-500 text-xs">(3)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/network/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                Network
                <span class="text-gray-500 text-xs">(2)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/network-programming/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                Network Programming
                <span class="text-gray-500 text-xs">(2)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/networking/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                Networking
                <span class="text-gray-500 text-xs">(4)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/programming/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                Programming
                <span class="text-gray-500 text-xs">(4)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/security/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                Security
                <span class="text-gray-500 text-xs">(1)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/system-design/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                System Design
                <span class="text-gray-500 text-xs">(1)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/web-development/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                Web Development
                <span class="text-gray-500 text-xs">(1)</span>
              </a>
              
              <a
                href="//localhost:1313/categories/web-security/"
                class="block px-4 py-2 text-gray-300 hover:bg-slate-700 hover:text-cyan-400 transition-colors text-sm"
              >
                Web Security
                <span class="text-gray-500 text-xs">(1)</span>
              </a>
              
            </div>
          </div>
        </div>
      </div>

      
      <button
        id="mobile-menu-button"
        class="md:hidden text-gray-300 hover:text-cyan-400 focus:outline-none"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          ></path>
        </svg>
      </button>
    </div>

    
    <div id="mobile-menu" class="hidden md:hidden pb-4">
      <a
        href="/"
        class="block py-2 text-gray-300 hover:text-cyan-400 transition-colors font-medium"
      >
        Home
      </a>

      
      
      <a
        href="/research/"
        class="block py-2 text-gray-300 hover:text-cyan-400 transition-colors font-medium"
      >
        Nghiên cứu
      </a>
      
      <a
        href="/portfolio/"
        class="block py-2 text-gray-300 hover:text-cyan-400 transition-colors font-medium"
      >
        Dự án
      </a>
      
      <a
        href="/about/"
        class="block py-2 text-gray-300 hover:text-cyan-400 transition-colors font-medium"
      >
        Về bản thân
      </a>
      
      <a
        href="/contact/"
        class="block py-2 text-gray-300 hover:text-cyan-400 transition-colors font-medium"
      >
        Liên hệ
      </a>
      

      <div class="py-2">
        <div class="font-medium text-white mb-2">Categories:</div>
        
        <a
          href="//localhost:1313/categories/backend/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          Backend
          <span class="text-gray-500 text-sm">(1)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/java/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          Java
          <span class="text-gray-500 text-sm">(6)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/javascript/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          JavaScript
          <span class="text-gray-500 text-sm">(3)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/network/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          Network
          <span class="text-gray-500 text-sm">(2)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/network-programming/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          Network Programming
          <span class="text-gray-500 text-sm">(2)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/networking/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          Networking
          <span class="text-gray-500 text-sm">(4)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/programming/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          Programming
          <span class="text-gray-500 text-sm">(4)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/security/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          Security
          <span class="text-gray-500 text-sm">(1)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/system-design/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          System Design
          <span class="text-gray-500 text-sm">(1)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/web-development/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          Web Development
          <span class="text-gray-500 text-sm">(1)</span>
        </a>
        
        <a
          href="//localhost:1313/categories/web-security/"
          class="block py-1 pl-4 text-gray-300 hover:text-cyan-400 transition-colors"
        >
          Web Security
          <span class="text-gray-500 text-sm">(1)</span>
        </a>
        
      </div>
    </div>
  </div>
</nav>


<script>
  document
    .getElementById("mobile-menu-button")
    .addEventListener("click", function () {
      const menu = document.getElementById("mobile-menu");
      menu.classList.toggle("hidden");
    });
</script>


    
    <main class="min-h-screen">
<div class="container mx-auto px-4 py-8">
  <div class="grid grid-cols-1 lg:grid-cols-10 gap-8">
    
    <div class="lg:col-span-7">
      <article
        class="bg-slate-800 border border-slate-700 rounded-lg shadow-lg p-8"
      >
        
        <header class="mb-8">
          
          
          <div class="mb-6 -mx-8 -mt-8">
            <img
              src="/images/java-nio.jpg"
              alt="Từ Blocking I/O đến Non-blocking I/O: Java NIO thay đổi cách Server xử lý mạng như thế nào?"
              class="w-full h-96 object-cover rounded-t-lg"
            />
          </div>
          

          <h1 class="text-4xl font-bold mb-4 text-white">Từ Blocking I/O đến Non-blocking I/O: Java NIO thay đổi cách Server xử lý mạng như thế nào?</h1>

          <div
            class="flex flex-wrap items-center gap-4 text-sm text-gray-400 mb-4"
          >
            
            <span class="flex items-center">
              <svg
                class="w-4 h-4 mr-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                ></path>
              </svg>
              16/12/2025
            </span>

            
            
          </div>

          
          
          <div class="flex flex-wrap gap-2 mb-4">
            
            <a
              href="/categories/java"
              class="px-3 py-1 bg-cyan-900 bg-opacity-30 text-cyan-300 border border-cyan-600 rounded-full text-sm hover:bg-cyan-800 hover:bg-opacity-40 transition-colors"
            >
              Java
            </a>
            
            <a
              href="/categories/backend"
              class="px-3 py-1 bg-cyan-900 bg-opacity-30 text-cyan-300 border border-cyan-600 rounded-full text-sm hover:bg-cyan-800 hover:bg-opacity-40 transition-colors"
            >
              Backend
            </a>
            
            <a
              href="/categories/system-design"
              class="px-3 py-1 bg-cyan-900 bg-opacity-30 text-cyan-300 border border-cyan-600 rounded-full text-sm hover:bg-cyan-800 hover:bg-opacity-40 transition-colors"
            >
              System Design
            </a>
            
          </div>
          

          
          
          <div class="flex flex-wrap gap-2">
            
            <a
              href="/tags/java"
              class="px-3 py-1 bg-slate-700 text-gray-300 rounded-full text-sm hover:bg-slate-600 transition-colors"
            >
              #Java
            </a>
            
            <a
              href="/tags/nio"
              class="px-3 py-1 bg-slate-700 text-gray-300 rounded-full text-sm hover:bg-slate-600 transition-colors"
            >
              #NIO
            </a>
            
            <a
              href="/tags/i/o"
              class="px-3 py-1 bg-slate-700 text-gray-300 rounded-full text-sm hover:bg-slate-600 transition-colors"
            >
              #I/O
            </a>
            
            <a
              href="/tags/concurrency"
              class="px-3 py-1 bg-slate-700 text-gray-300 rounded-full text-sm hover:bg-slate-600 transition-colors"
            >
              #Concurrency
            </a>
            
            <a
              href="/tags/server"
              class="px-3 py-1 bg-slate-700 text-gray-300 rounded-full text-sm hover:bg-slate-600 transition-colors"
            >
              #Server
            </a>
            
            <a
              href="/tags/network-programming"
              class="px-3 py-1 bg-slate-700 text-gray-300 rounded-full text-sm hover:bg-slate-600 transition-colors"
            >
              #Network Programming
            </a>
            
            <a
              href="/tags/performance"
              class="px-3 py-1 bg-slate-700 text-gray-300 rounded-full text-sm hover:bg-slate-600 transition-colors"
            >
              #Performance
            </a>
            
          </div>
          
        </header>

        
        <div
          class="prose prose-invert max-w-none prose-headings:font-bold prose-headings:text-white prose-a:text-cyan-400 prose-a:no-underline hover:prose-a:underline prose-img:rounded-lg prose-pre:bg-slate-950 prose-pre:border prose-pre:border-slate-700 prose-code:text-cyan-300 text-gray-300"
        >
          <h2 id="khi-một-thread-chỉ-phục-vụ-một-kết-nối">Khi một thread chỉ phục vụ một kết nối</h2>
<p>Mô hình server Java đơn giản nhất hoạt động theo kiểu một thread cho một kết nối: mỗi khi có client kết nối, server tạo một thread mới để xử lý. ServerSocket chấp nhận kết nối, khởi tạo thread mới, thread đó đọc yêu cầu, xử lý logic nghiệp vụ, gửi kết quả trả về, rồi kết thúc. Cách tiếp cận này có logic rõ ràng và code dễ hiểu, không phức tạp.</p>
<p>Vấn đề chỉ bộc lộ khi số lượng kết nối đồng thời tăng lên. Với mô hình blocking I/O truyền thống, mỗi khi thread gọi <code>socket.read()</code> hoặc <code>socket.write()</code>, nó bị chặn cho đến khi thao tác hoàn thành. Nếu client chậm, mạng bị tắc nghẽn, hoặc đơn giản là client đang chờ đợi, thread ở server phải ngồi chờ. Không làm gì cả, chỉ chờ. CPU không tốn nhiều, nhưng thread thì chiếm bộ nhớ và tài nguyên hệ thống.</p>
<p>Khi có mười, hai mươi kết nối đồng thời thì vẫn chấp nhận được. Nhưng khi lên hàng trăm, hàng nghìn kết nối, việc tạo ra cùng số lượng threads bắt đầu thành vấn đề nghiêm trọng. Mỗi thread trong Java chiếm khoảng 1MB bộ nhớ stack mặc định. Một nghìn threads nghĩa là 1GB RAM chỉ cho stack, chưa kể bộ nhớ heap và các chi phí phụ khác. Tệ hơn là việc chuyển ngữ cảnh giữa hàng nghìn threads làm CPU bị quá tải, hiệu năng sụt giảm thảm hại thay vì tăng.</p>
<p>Trường hợp thực tế điển hình là một server xử lý các kết nối WebSocket. Ban đầu kiểm tra với vài trăm clients thì mọi thứ hoạt động ổn định. Tuy nhiên khi triển khai thật với vài nghìn người dùng đồng thời, server bắt đầu chậm, thời gian phản hồi tăng vọt, cuối cùng sập với lỗi OutOfMemoryError. Hệ thống giám sát cho thấy số lượng threads vượt quá mười nghìn. JVM không thể tạo thêm threads nữa. Đây là bằng chứng rõ ràng cho thấy mô hình một thread cho một kết nối không thể mở rộng được.</p>
<h2 id="vấn-đề-không-phải-ở-thread-mà-ở-blocking">Vấn đề không phải ở thread, mà ở blocking</h2>
<p>Điều khiến mô hình truyền thống không hiệu quả không phải là việc dùng threads, mà là việc threads bị chặn vô nghĩa. Trong phần lớn thời gian, một kết nối đang chờ dữ liệu từ mạng. Client gửi yêu cầu HTTP, nhưng dữ liệu đến server qua mạng không phải tức thì. Nó đi qua routers, switches, có thể bị trì hoãn vì giới hạn băng thông hoặc tắc nghẽn mạng. Ở phía server, thread gọi <code>inputStream.read()</code> và bị chặn cho đến khi có đủ dữ liệu.</p>
<p>Trong thời gian chờ đợi này, thread không làm gì hữu ích. Nó không tiêu thụ CPU, nhưng nó vẫn tồn tại, chiếm bộ nhớ, và là một mục trong bảng thread của JVM. Bộ lập lịch của hệ điều hành vẫn phải xem xét nó khi lập lịch. Nếu có một nghìn threads đang bị chặn chờ I/O, đó là một nghìn threads không làm việc nhưng vẫn tốn tài nguyên.</p>
<p>Giải pháp cần thiết không phải là một thread cho mỗi kết nối. Điều cần thiết là khả năng để một thread xử lý nhiều kết nối. Nhưng làm sao để một thread biết kết nối nào đang có dữ liệu sẵn sàng để đọc mà không bị chặn khi kiểm tra từng kết nối một? Đó là lúc Java NIO xuất hiện.</p>
<h2 id="java-nio-và-ý-tưởng-non-blocking-io">Java NIO và ý tưởng non-blocking I/O</h2>
<p>Java NIO (New I/O, hoặc Non-blocking I/O) ra đời trong Java 1.4 với một tư duy hoàn toàn khác. Thay vì thread bị chặn khi chờ I/O, NIO cho phép thread kiểm tra xem thao tác I/O có thể thực hiện được không trước khi thực sự làm. Nếu chưa sẵn sàng, thread không cần chờ, nó có thể làm việc khác hoặc kiểm tra kết nối khác.</p>
<p>Cốt lõi của NIO là ba khái niệm: Channels, Buffers và Selectors. Channel trong NIO giống như socket trong blocking I/O, nhưng nó có thể được cấu hình thành chế độ không chặn. Buffer là vùng nhớ để đọc/ghi dữ liệu. Nhưng thành phần quan trọng nhất là Selector.</p>
<p>Selector cho phép một thread duy nhất giám sát nhiều channels cùng lúc. Các channels được đăng ký với Selector, chỉ định các thao tác cần quan sát (đọc, ghi, chấp nhận kết nối, kết nối). Khi gọi <code>selector.select()</code>, phương thức này sẽ chặn cho đến khi ít nhất một channel sẵn sàng cho thao tác đã đăng ký. Quan trọng là nó chỉ trả về khi có sự kiện xảy ra, không phải kiểm tra thăm dò liên tục.</p>
<p>Điều này tạo ra một sự thay đổi hoàn toàn về mặt tư duy. Thay vì thread chờ từng kết nối, một thread có thể chờ bất kỳ kết nối nào trong nhóm sẵn sàng. Khi có kết nối sẵn sàng, thread xử lý nó, rồi quay lại chờ tiếp. Một thread có thể xử lý hàng nghìn kết nối mà không cần tạo ra hàng nghìn threads.</p>
<h2 id="ghép-kênh-ở-tầng-hệ-điều-hành">Ghép kênh ở tầng hệ điều hành</h2>
<p>Để hiểu tại sao Selector hiệu quả, cần nhìn xuống tầng hệ điều hành. Trên Linux, NIO Selector sử dụng epoll (hoặc select/poll trên các hệ thống cũ hơn). Trên Windows, nó dùng I/O Completion Ports. Đây là các lệnh gọi hệ thống cho phép ứng dụng giám sát nhiều mô tả tệp (sockets) cùng lúc.</p>
<p>Epoll hoạt động rất hiệu quả. Thay vì kernel phải quét qua tất cả mô tả tệp mỗi lần kiểm tra (như select/poll làm), epoll duy trì một danh sách sự kiện. Khi có sự kiện I/O xảy ra, kernel thêm mô tả tệp vào danh sách sẵn sàng. Ứng dụng chỉ cần kiểm tra danh sách sẵn sàng này, không cần quét hết tất cả mô tả. Độ phức tạp là O(1) cho số lượng sự kiện sẵn sàng, không phải O(n) cho tổng số kết nối.</p>
<p>Điều này có nghĩa là server có thể duy trì hàng chục nghìn kết nối với chi phí phụ tối thiểu. Kernel sẽ thông báo cho ứng dụng chỉ khi có kết nối thực sự có sự kiện. Ứng dụng không lãng phí chu kỳ CPU kiểm tra các kết nối không có gì mới.</p>
<h2 id="mẫu-code-của-nio-server">Mẫu code của NIO server</h2>
<p>Triển khai một NIO server khác khá nhiều so với blocking I/O server. Thay vì vòng lặp chấp nhận-tạo-thread, NIO server có một vòng lặp sự kiện chính. Thread này chạy vòng lặp vô hạn, gọi <code>selector.select()</code> để chờ sự kiện, rồi xử lý từng sự kiện khi chúng đến.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Selector selector <span style="color:#f92672">=</span> Selector.<span style="color:#a6e22e">open</span>();
</span></span><span style="display:flex;"><span>ServerSocketChannel serverChannel <span style="color:#f92672">=</span> ServerSocketChannel.<span style="color:#a6e22e">open</span>();
</span></span><span style="display:flex;"><span>serverChannel.<span style="color:#a6e22e">configureBlocking</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>serverChannel.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">new</span> InetSocketAddress(8080));
</span></span><span style="display:flex;"><span>serverChannel.<span style="color:#a6e22e">register</span>(selector, SelectionKey.<span style="color:#a6e22e">OP_ACCEPT</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>    selector.<span style="color:#a6e22e">select</span>(); <span style="color:#75715e">// Chặn cho đến khi có sự kiện</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Set<span style="color:#f92672">&lt;</span>SelectionKey<span style="color:#f92672">&gt;</span> selectedKeys <span style="color:#f92672">=</span> selector.<span style="color:#a6e22e">selectedKeys</span>();
</span></span><span style="display:flex;"><span>    Iterator<span style="color:#f92672">&lt;</span>SelectionKey<span style="color:#f92672">&gt;</span> iterator <span style="color:#f92672">=</span> selectedKeys.<span style="color:#a6e22e">iterator</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (iterator.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>        SelectionKey key <span style="color:#f92672">=</span> iterator.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>        iterator.<span style="color:#a6e22e">remove</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (key.<span style="color:#a6e22e">isAcceptable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Client mới kết nối</span>
</span></span><span style="display:flex;"><span>            ServerSocketChannel server <span style="color:#f92672">=</span> (ServerSocketChannel) key.<span style="color:#a6e22e">channel</span>();
</span></span><span style="display:flex;"><span>            SocketChannel client <span style="color:#f92672">=</span> server.<span style="color:#a6e22e">accept</span>();
</span></span><span style="display:flex;"><span>            client.<span style="color:#a6e22e">configureBlocking</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>            client.<span style="color:#a6e22e">register</span>(selector, SelectionKey.<span style="color:#a6e22e">OP_READ</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (key.<span style="color:#a6e22e">isReadable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Client có dữ liệu để đọc</span>
</span></span><span style="display:flex;"><span>            SocketChannel client <span style="color:#f92672">=</span> (SocketChannel) key.<span style="color:#a6e22e">channel</span>();
</span></span><span style="display:flex;"><span>            ByteBuffer buffer <span style="color:#f92672">=</span> ByteBuffer.<span style="color:#a6e22e">allocate</span>(1024);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> bytesRead <span style="color:#f92672">=</span> client.<span style="color:#a6e22e">read</span>(buffer);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (bytesRead <span style="color:#f92672">==</span> <span style="color:#f92672">-</span>1) {
</span></span><span style="display:flex;"><span>                client.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Xử lý dữ liệu</span>
</span></span><span style="display:flex;"><span>                buffer.<span style="color:#a6e22e">flip</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// ... logic xử lý ...</span>
</span></span><span style="display:flex;"><span>                key.<span style="color:#a6e22e">interestOps</span>(SelectionKey.<span style="color:#a6e22e">OP_WRITE</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (key.<span style="color:#a6e22e">isWritable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Client sẵn sàng để nhận phản hồi</span>
</span></span><span style="display:flex;"><span>            SocketChannel client <span style="color:#f92672">=</span> (SocketChannel) key.<span style="color:#a6e22e">channel</span>();
</span></span><span style="display:flex;"><span>            ByteBuffer response <span style="color:#f92672">=</span> getResponseBuffer(key);
</span></span><span style="display:flex;"><span>            client.<span style="color:#a6e22e">write</span>(response);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>response.<span style="color:#a6e22e">hasRemaining</span>()) {
</span></span><span style="display:flex;"><span>                key.<span style="color:#a6e22e">interestOps</span>(SelectionKey.<span style="color:#a6e22e">OP_READ</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Code này trông khác lạ đối với người quen với blocking I/O. Không có threads riêng cho mỗi kết nối. Không có thao tác đọc/ghi chặn. Thay vào đó, toàn bộ logic được tổ chức theo sự kiện. Khi có sự kiện, xử lý sự kiện đó, rồi quay lại chờ sự kiện tiếp theo.</p>
<p>Cái giá phải trả là độ phức tạp. Blocking I/O code dễ đọc, dễ gỡ lỗi, luồng chạy tuyến tính. NIO code phức tạp hơn nhiều. Logic bị phân mảnh theo các bộ xử lý sự kiện khác nhau. Quản lý trạng thái trở nên khó khăn vì không có thread riêng duy trì trạng thái cho mỗi kết nối. Trạng thái phải được gắn vào SelectionKey hoặc duy trì trong bảng ánh xạ bên ngoài.</p>
<h2 id="kiến-trúc-hướng-sự-kiện-và-vòng-callback-lồng-nhau">Kiến trúc hướng sự kiện và vòng callback lồng nhau</h2>
<p>Mô hình NIO về bản chất là hướng sự kiện. Thay vì mệnh lệnh &ldquo;đọc yêu cầu, xử lý, gửi phản hồi&rdquo; theo tuần tự, NIO làm việc theo cơ chế phản ứng &ldquo;khi có sự kiện X, làm Y&rdquo;. Điều này khá giống với vòng lặp sự kiện JavaScript trong Node.js hoặc trình duyệt.</p>
<p>Trong JavaScript, các bộ xử lý sự kiện được đăng ký cho các sự kiện khác nhau. Sự kiện nhấp chuột, callback hẹn giờ, phản hồi AJAX. Vòng lặp sự kiện của trình duyệt liên tục kiểm tra sự kiện và thực thi các bộ xử lý tương ứng. NIO Selector hoạt động tương tự, nhưng ở Java và với các sự kiện I/O mạng.</p>
<p>Mẫu này mạnh mẽ nhưng cũng có những cạm bẫy. Khi logic phức tạp, có thể rơi vào &ldquo;vòng callback lồng nhau&rdquo; - các callbacks lồng nhau khó duy trì. Trong NIO, nếu thao tác yêu cầu nhiều lượt tương tác (gửi yêu cầu, chờ phản hồi, xử lý, gửi tiếp theo), code có thể trở nên rối rắm. Trạng thái phải được theo dõi thủ công cho mỗi giai đoạn của thao tác.</p>
<p>Để giải quyết, nhiều khung làm việc xây dựng các lớp trừu tượng lên trên NIO. Netty, AsynchronousSocketChannel tích hợp sẵn của Java, các thư viện phản ứng như Project Reactor hay RxJava. Chúng cung cấp các API cấp cao hơn để làm việc với I/O không đồng bộ mà không cần xử lý trực tiếp với Selector và SelectionKeys ở tầng thấp.</p>
<h2 id="khả-năng-mở-rộng-và-sử-dụng-tài-nguyên">Khả năng mở rộng và sử dụng tài nguyên</h2>
<p>Lợi ích lớn nhất của NIO là khả năng mở rộng. Với blocking I/O và mô hình một thread cho một kết nối, server bị giới hạn bởi số lượng threads có thể tạo ra. Hầu hết JVMs đạt giới hạn ở vài nghìn threads trước khi hiệu năng giảm nghiêm trọng hoặc gặp lỗi OutOfMemoryError.</p>
<p>Với NIO, giới hạn không phải threads mà là mô tả tệp. Trên Linux, mỗi tiến trình có giới hạn số mô tả tệp có thể mở (thường cấu hình qua ulimit). Giới hạn này có thể tăng lên hàng chục hoặc hàng trăm nghìn. Một NIO server với một hoặc vài threads có thể xử lý hàng chục nghìn kết nối đồng thời.</p>
<p>Trong thực tế, một server WebSocket được cải tiến lại từ blocking I/O sang NIO đã cho thấy sự cải thiện đáng kể. Trước khi cải tiến, server với 4GB RAM chỉ chịu được khoảng 3000 kết nối đồng thời. Sau khi cải tiến sử dụng NIO, cùng 4GB RAM, server xử lý được 50,000 kết nối. Việc sử dụng bộ nhớ chủ yếu là các buffer cho dữ liệu và thông tin kết nối, không phải stack của threads. Việc sử dụng CPU thấp hơn vì ít chuyển ngữ cảnh.</p>
<p>Tất nhiên, để đạt được hiệu suất này cần điều chỉnh cẩn thận. Kích thước buffers, số lượng selector threads, chiến lược xử lý logic nghiệp vụ. Nếu logic nghiệp vụ nặng và chạy trong selector thread, nó sẽ chặn vòng lặp sự kiện và làm giảm thông lượng. Thực hành tốt nhất là selector thread chỉ xử lý I/O, giao logic nghiệp vụ cho nhóm thread xử lý riêng.</p>
<h2 id="nio-trong-các-khung-làm-việc-hiện-đại">NIO trong các khung làm việc hiện đại</h2>
<p>Hầu hết các khung làm việc và application servers Java hiện đại đều sử dụng NIO bên dưới. Netty là một khung NIO phổ biến nhất, được dùng bởi vô số dự án: Elasticsearch, Cassandra, triển khai gRPC Java, Play Framework, và nhiều nữa. Netty trừu tượng hóa độ phức tạp của NIO, cung cấp API hướng sự kiện dễ dùng hơn, và tối ưu hiệu năng đến mức cực kỳ cao.</p>
<p>Apache Tomcat từ phiên bản 8.5 dùng NIO connector mặc định. Jetty cũng vậy. Spring WebFlux, khung web phản ứng của Spring, được xây dựng trên Project Reactor và hỗ trợ các servers dựa trên NIO như Netty hoặc Undertow. Tất cả nhằm đạt được I/O không chặn cho khả năng mở rộng tốt hơn.</p>
<p>Node.js, thường được so sánh với Java về hiệu năng, cũng sử dụng vòng lặp sự kiện tương tự. Libuv, thư viện mà Node.js dựa vào, dùng epoll/kqueue/IOCP tùy nền tảng, giống như Java NIO Selector. Tư duy là giống nhau: một hoặc vài threads giám sát nhiều kết nối, xử lý sự kiện khi chúng đến.</p>
<p>Ngay cả khi không trực tiếp lập trình với NIO, hiểu về nó giúp đánh giá cao các khung làm việc đang sử dụng. Khi cấu hình Netty hoặc điều chỉnh Tomcat NIO connector, biết cách chúng hoạt động bên dưới giúp đưa ra quyết định sáng suốt về kích thước nhóm thread, cấu hình buffers, thiết lập hàng chờ kết nối.</p>
<h2 id="đánh-đổi-và-khi-nào-nên-dùng">Đánh đổi và khi nào nên dùng</h2>
<p>NIO không phải là giải pháp hoàn hảo cho mọi vấn đề. Nó tốt cho các ứng dụng phụ thuộc I/O với nhiều kết nối đồng thời nhưng mỗi yêu cầu không đòi hỏi nhiều tính toán. Ví dụ điển hình là các máy chủ proxy, cổng API, máy chủ WebSocket, ứng dụng trò chuyện. Những trường hợp sử dụng này phần lớn thời gian là chờ I/O, ít công việc tính toán nặng.</p>
<p>Nếu ứng dụng phụ thuộc CPU, ví dụ xử lý ảnh hoặc tính toán phức tạp, NIO không giúp được nhiều. Vấn đề không phải chờ I/O mà là thời gian tính toán. Khi đó, nhóm thread với blocking I/O hoặc các khung xử lý song song như Fork/Join có thể phù hợp hơn.</p>
<p>NIO cũng khó gỡ lỗi và kiểm thử hơn. Tình trạng tranh chấp, lỗi quản lý trạng thái trong code hướng sự kiện nổi tiếng khó xử lý. Blocking I/O code với một thread cho một yêu cầu dễ suy luận về hành vi. Mỗi yêu cầu có đường chạy riêng, dễ theo dõi. NIO code nhiều yêu cầu chia sẻ threads, khó theo dõi những gì đang xảy ra.</p>
<p>Thời gian phát triển cũng là một vấn đề cần xem xét. Viết NIO code từ đầu tốn nhiều thời gian hơn blocking I/O. Phải xử lý buffers, đọc/ghi từng phần, quản lý trạng thái. Nếu yêu cầu mở rộng không cao, sự đơn giản của blocking I/O có thể là sự đánh đổi đáng giá.</p>
<h2 id="từ-nio-đến-nio2-và-tương-lai">Từ NIO đến NIO.2 và tương lai</h2>
<p>Java 7 giới thiệu NIO.2 (hay còn gọi là AIO - Asynchronous I/O) với AsynchronousSocketChannel và AsynchronousServerSocketChannel. Khác với cách tiếp cận dựa trên selector của NIO, NIO.2 dùng callback hoặc API dựa trên Future. Thao tác I/O được khởi tạo và callback sẽ được gọi khi thao tác hoàn thành.</p>
<p>NIO.2 có mức độ trừu tượng cao hơn NIO, dễ sử dụng hơn trong một số trường hợp. Nhưng nó không thay thế hoàn toàn NIO. Netty vẫn dùng cách tiếp cận selector của NIO vì hiệu năng và khả năng kiểm soát. NIO.2 có thể tiện lợi nhưng đôi khi chi phí phụ cao hơn.</p>
<p>Tương lai của Java I/O đang hướng tới Project Loom. Loom giới thiệu virtual threads (fibers), các threads nhẹ được quản lý bởi JVM thay vì hệ điều hành. Với virtual threads, code có thể viết theo kiểu chặn nhưng bên dưới runtime lập lịch virtual threads hiệu quả, không tạo threads hệ điều hành cho mỗi kết nối. Ý tưởng là sự đơn giản của một thread cho một yêu cầu với khả năng mở rộng của NIO.</p>
<p>Khi Loom ổn định và được áp dụng rộng rãi, có thể sẽ có sự chuyển dịch trở lại về code kiểu chặn nhưng với runtime khác. Cho đến lúc đó, NIO vẫn là nền tảng của các máy chủ Java hiệu năng cao.</p>
<h2 id="kết-luận">Kết luận</h2>
<p>Java NIO không chỉ là một API mới, mà là một sự thay đổi hoàn toàn tư duy trong cách thiết kế ứng dụng server. Nó buộc lập trình viên phải nghĩ về I/O theo mô hình hướng sự kiện thay vì mô hình chặn tuần tự. Sự đánh đổi là độ phức tạp tăng, nhưng phần thưởng là khả năng mở rộng lên hàng bậc về số kết nối đồng thời.</p>
<p>Hiểu NIO giúp đánh giá cao các khung làm việc hiện đại. Netty, Spring WebFlux, lập trình phản ứng - tất cả đều được xây dựng trên nền tảng này. Ngay cả khi không lập trình trực tiếp với Selector và Channels, các khái niệm của I/O không chặn, vòng lặp sự kiện, ghép kênh vẫn liên quan cho thiết kế hệ thống.</p>
<p>Blocking I/O vẫn có chỗ đứng cho các ứng dụng đơn giản, yêu cầu đồng thời thấp. Nhưng khi mở rộng là mục tiêu, khi số kết nối đồng thời lên hàng nghìn hoặc hàng chục nghìn, NIO là câu trả lời. Đó không phải chỉ là kỹ thuật tối ưu, mà là tư duy khác về cách server tương tác với mạng.</p>
<hr>
<p><strong>Tham khảo:</strong></p>
<ul>
<li>&ldquo;Java NIO&rdquo; - Ron Hitchens</li>
<li>&ldquo;Netty in Action&rdquo; - Norman Maurer &amp; Marvin Allen Wolfthal</li>
<li>Java NIO Documentation - Oracle</li>
<li>&ldquo;Scalable I/O in Java&rdquo; - Doug Lea</li>
</ul>

        </div>
      </article>
    </div>

    
    <div class="lg:col-span-3">
<div
  class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-lg shadow-lg p-6"
>
  
  
  <div class="text-center mb-4">
    <img
      src="/images/avatar.jpg"
      alt="Lý Thuận An"
      class="w-48 h-48 rounded-lg mx-auto object-cover shadow-md border-4 border-slate-700"
    />
  </div>
  

  
  <h3
    class="text-lg font-bold mb-2 text-white text-center flex items-center justify-center"
  >
    <svg
      class="w-5 h-5 mr-2 text-cyan-400"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
      ></path>
    </svg>
    ABOUT ME
  </h3>

  
  <div class="space-y-3">
    
    
    <div class="text-center">
      <h4 class="font-bold text-white text-xl">
        Lý Thuận An
      </h4>
    </div>
    

    
    
    <p class="text-gray-400 text-sm text-center leading-relaxed italic">
      Kỹ sư AI tương lai, đam mê mã nguồn mở, yêu thích khám phá công nghệ và trải nghiệm cuộc sống
    </p>
    

    
    
    <p class="text-gray-300 leading-relaxed text-sm">
      Mình là Lý Thuận An, đang theo học năm cuối chuyên ngành Trí tuệ nhân tạo tại Đại học Công nghệ TP.HCM (HUTECH). Định hướng nghề nghiệp của mình tập trung vào việc kết nối nghiên cứu AI với phát triển ứng dụng thực tế.
    </p>
    

    
    <div class="space-y-2 pt-2">
      
      <a
        href="mailto:anly1704@gmail.com"
        class="flex items-center text-gray-300 hover:text-cyan-400 transition-colors text-sm"
      >
        <svg
          class="w-4 h-4 mr-2 text-cyan-400"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"
          />
        </svg>
        anly1704@gmail.com
      </a>
       
      <div class="flex items-center text-gray-300 text-sm">
        <svg
          class="w-4 h-4 mr-2 text-cyan-400"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"
          />
        </svg>
        &#43;84 769 339 058
      </div>
      
    </div>

    
    <div class="flex items-center justify-center gap-3 pt-3">
      
      <a
        href="https://github.com/aresu-1704"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center justify-center w-10 h-10 bg-gray-700 hover:bg-gray-600 text-white rounded-full transition-all duration-200 hover:scale-110"
        title="GitHub"
      >
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
          />
        </svg>
      </a>
       
      <a
        href="https://www.facebook.com/an.thuan.3139241"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-500 text-white rounded-full transition-all duration-200 hover:scale-110"
        title="Facebook"
      >
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"
          />
        </svg>
      </a>
      
    </div>
  </div>
  
</div>
</div>
  </div>
</div>
</main>

    
    <footer
      class="bg-slate-950 text-gray-400 py-8 mt-12 border-t border-slate-800"
    >
      <div class="container mx-auto px-4 text-center">
        <p>&copy; 2025 THUẬN AN IT BLOG. All rights reserved.</p>
      </div>
    </footer>

    
    <script src="/js/search.js"></script>
  </body>
</html>
